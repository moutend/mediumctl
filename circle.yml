machine:
  pre:
    - mkdir -p $GOPATH/bin
    - mkdir -p $GOPATH/src
    - curl -L https://github.com/Masterminds/glide/releases/download/v0.12.3/glide-v0.12.3-linux-amd64.tar.gz | tar xvz
    - pwd
    - mv linux-amd64/glide $GOPATH/bin
    - glide install
    - cp -r ./vendor/github.com $GOPATH/src
deployment:
  release:
    tag: /v[0-9]+\.[0-9]+\.[0-9]+/
    commands:
    - go get github.com/tcnksm/ghr
    - make clean
    - make VERSION=$CIRCLE_TAG
    - rm -rf bin/.*
    - ghr -t $GITHUB_TOKEN -u $CIRCLE_PROJECT_USERNAME -r $CIRCLE_PROJECT_REPONAME --replace $CIRCLE_TAG bin/
