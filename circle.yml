machine:
  pre:
    - mkdir -p $HOME/.go_workspace/src
    - curl -L https://github.com/Masterminds/glide/releases/download/v0.12.3/glide-v0.12.3-linux-amd64.tar.gz | tar xvz
    - sudo mv linux-amd64/glide /usr/local/bin
    - cd $HOME/mediumctl && glide install
    - cp -r $HOME/mediumctl/vendor/github.com $HOME/.go_workspace/src
test:
  override:
    - go test
deployment:
  release:
    tag: /v[0-9]+\.[0-9]+\.[0-9]+/
    commands:
    - go get github.com/tcnksm/ghr
    - make clean
    - make VERSION=$CIRCLE_TAG
    - rm -rf bin/.*
    - ghr -t $GITHUB_TOKEN -u $CIRCLE_PROJECT_USERNAME -r $CIRCLE_PROJECT_REPONAME --replace $CIRCLE_TAG bin/
